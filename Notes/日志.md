# 和C++期末大作业

## 数据库类的封装

 由于在登陆的时候会涉及数据库的查询，在登录之后对菜单查询也会涉及数据库的查询所以封装一个数据库类`dbconnect`是很重要的。默认使用的`MYSQL`，后期会换成`redis`。

###  成员变量

数据库中应该涉及数据库名称、用户名称和密码，我都是使用`std::string`来进行封装的，并使用`private`关键字增加封装性。并设置了一个带这三个参数的构造函数以初始化这三个`private`变量。

还有一个qt中的封装好了的数据库对象。

```c++
private:
    std::string dataBaseName; // 表示要连接mysql中的哪一个数据库
    std::string username;
    std::string password;
    QSqlDatabase db;
```

### 成员函数

#### 连接

涉及数据库的话，最重要的应该就是连接操作了，因此我设计了一个`connect`函数，它会连接指定的数据库并返回是否连接成功。这里面涉及一个`std::string`和`QString`的转变。

由于在qt中的字符串是自己封装过的类(`QString`)，可以参考[qt中QString和`std::string`的转化](https://cloud.tencent.com/developer/article/1812844)。

---

数据库的DML无非就是增删改查，由于登陆界面要使用查询，所以先完成查询函数。

#### 查询

在qt中已经为我们封装了`QSqlQuery`对象，只需要我们调用即可。

## 信号和槽（如何给按钮添加信号）

人点击按钮，然后使窗口关闭。可以抽象化成**按钮**发送了**信号**给**窗口**，然后窗口执行信号处理函数（槽函数）后关闭。

### 松散耦合

信号槽的一个优点就是松散耦合（虽然我并不知道这个词是怎么翻译过来的，但是确实是这样）。意思就是说发送方和接收方之间本身是没有关联的，按下按钮也可能跳转到下一个界面，它们之间是通过一个`connect`函数耦合在一起的。（为啥一定要用耦合这个词呢，用连接不更通俗易懂吗）。

这涉及一个连接函数`connect`，在连接函数中我们需要4个参数，分别是信号的发送者、具体的信号、信号的接收者以及信号处理函数（槽函数）。

### 发送的信号

具体的信号是继承于`QPushButton`的，对于这个参数Qt要求我们传入地址，比如如果是点击信号，则是`&QPushButton::click`。

### 处理的槽函数

具体的槽函数是继承于`QWidget`的，里面有许多处理的槽函数，比如`open`、`close`等等，也需要传入地址，即`&QWidget::show`（注意没有括号）。

---

发出的信号由槽函数进行处理。

### 具体需求

现在我的一个需求就是，当用户输入用户名与密码正确之后，就立即发送一个信号给`mainwindow`对象让它打开。<font color="red">暴力解决了，就是直接在函数里面`new`了一个新对象</font>。

## 菜系数据库设计

我想在主界面中做一个菜系选择表，这是用`QComBox`来实现的，每当下拉选择的时候都发送一个信号，然后去数据库查询对应的数据显示在列表中。

### 解决`mysql`的中文显示的问题

要不就说可视化的好呢，可以直接在navicat中指定编码是utf8.

### 设计表项

```mysql
INSERT INTO menu (dishName, description, price, cuisine) values("臭鳜鱼", "这是一道徽州地区的传统美食，以徽派独特的烹饪技艺著称。臭鳜鱼的臭味不同于寻常的臭味，而是一种独特的风味。", 30, "徽菜"),
("徽州烧鸽", "烧鸽是徽州地方的传统名菜，以其独特的烹饪工艺和鲜美的味道而著称。", 45, "徽菜"),
("徽州牛肉汤", "徽州牛肉汤是一道具有徽州地方特色的传统徽菜，以其鲜美的牛肉和独特的调味品而受欢迎。", 15, "徽菜");
```

```mysql
INSERT INTO menu (dishName, description, price, cuisine) values("毛血旺", "食材多是鸭血，肉片，还有必不可少的豆芽，还有一些解腻的青菜。汤汁红润，色泽诱人。ma'la", 80, "川菜"),
("夫妻肺片", "夫妻肺片没有夫妻！主要使用牛心，牛肚，牛肉，牛舌等。它的口感麻辣纯香，让人欲罢不能。", 28, "川菜"),
("回锅肉", "主要使用猪后臀肉，配上青椒和蒜苗等配料烹饪而成。它的口感独特，肥而不腻，是一道非常适合下饭的菜。", 30, "川菜");
```

## 点菜端的设计

由于作业要求能看到菜品评价，所以我打算使用checkbox发送信号给其他的table view来显示评价。
